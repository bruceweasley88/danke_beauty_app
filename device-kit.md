# 单蓝牙控制协议-移动端
## 背景
适用于使用BT2G等蓝牙模组时

## 1. 协议内容
### 1.1. 控制服务UUID
模组通过蓝牙与APP/小程序上报数据或APP/小程序向模组下发数据使用控制服务UUID
### 广云蓝牙控制服务UUID信息(Combo/BLE)

| 类型 | UUID | properties | 随串口密钥组指令启动 |
| --- | --- | --- | --- |
| 服务UUID | 0000EE01-0000-1000-8000-00805f9b34fb | | |
| 数据上报UUID | 0000EE02-0000-1000-8000-00805f9b34fb | NOTIFICATION | |
| 数据下行UUID | 0000EE03-0000-1000-8000-00805f9b34fb | WRITE | |

### 1.2. 数据包格式
#### 1.2.1. 每包完整的内容
注意:每包总长度20字节,若发送数据超过20字节则需进行分包
举例数据(16进制数据): 01 01 02 01 00 01 0A 01
- 01：蓝牙数据ID
- 01：包序号
- 02：随机数
- 01：数据点数量
- 00 01：数据点ID
- 0A：数据点类型uint8
- 01：数据点的值

| 字段 | 长度 | 说明 |
| --- | --- | --- |
| 每帧蓝牙数据ID | 1 byte | 从0x01到0xFF循环，同一帧数据此字节一致(分包时同一组数据一致) |
| 包序号 | 1 byte | 当前数据包序号，从0x01开始递增(分包时，每个包序号不一样) |
| 随机数 | 1 byte | 可使用随机数，用于偏移量 |
| 数据包 | n byte | 根据具体要发送的数据点数量来组包 |

##### 数据包格式
| 字段 | 长度 | 说明 |
| --- | --- | --- |
| 数据点数量 | 1 byte | 数据点数量 |
| 数据点ID | 2 byte | 数据点的ID(平台上的产品物模型中的ID，举例:1,2) |
| 数据点类型 | 1 byte | 数据点类型(如下表表格所示) |
| 数据长度 | 2 byte | 仅raw、string类型需要，其他类型无此部分 |
| 数据点对应值 | n byte | 数据点对应值(根据数据点类型动态变化) |

##### 数据点类型说明
表1. 数据类型汇总表

| 数据类型 | 数据类型格式(低4位为数值长度) | 数值长度 | 字符数值范围 | 字符转十六进制说明(反向转换同理) | 转换示例 |
| --- | --- | --- | --- | --- | --- |
| RAW | 0xAF | N | | 二进制转16进制 | 11110000 → F0 |
| BOOL | 0x01 | 1 | 0-1 | 10进制转16进制 | 0 → 00 |
| Uint8 | 0x11 | 1 | 0-255 | 10进制转16进制 | 10 → 0A |
| Uint16 | 0x12 | 2 | 0-65535 | 10进制转16进制 | 2570 → 0A 0A |
| Uint32 | 0x14 | 4 | 0-4294967295 | 10进制转16进制 | 168430090 → 0A 0A 0A 0A |
| Int8 | 0x21 | 1 | -128-127 | 10进制转16进制 | -128 → 80；0 → 00；127 → 7F |
| Int16 | 0x22 | 2 | -32768-32767 | 10进制转16进制 | -128 → FF 80；0 → 00 00；127 → 00 7F |
| Int32 | 0x24 | 4 | -2147483648-2147483647 | 10进制转16进制 | -128 → FF FF FF 80；0 → 00 00 00 00；127 → 00 00 00 7F |
| Fault8 | 0x41 | 1 | 0-255 | 10进制转16进制 | 1 → 01 |
| Fault16 | 0x42 | 2 | 0-65535 | 10进制转16进制 | 1 → 00 01 |
| Enum | 0x51 | 1 | 0-255 | 10进制转16进制 | 1 → 01 |
| String | 0xBF | N | | ASCII | A → 41 |

#### 1.2.2. 分包组包格式
当要发的数据超过20字节是则要进行拆包发送

##### 分包第一包数据格式
| 字段 | 长度 | 说明 |
| --- | --- | --- |
| 每帧蓝牙数据ID | 1 byte | 从0x01到0xFF循环，同一帧数据此字节一致(分包时同一组数据一致) |
| 包序号 | 1 byte | 当前数据包序号，从0x01开始递增(分包时，每个包序号不一样) |
| 蓝牙数据包ID | 1 byte | 可使用随机数，用于偏移量 |
| 数据包 | n byte | 根据具体要发送的数据点数量来组包 |

##### 分包第二包数据格式
| 字段 | 长度 | 说明 |
| --- | --- | --- |
| 每帧蓝牙数据ID | 1 byte | 从0x01到0xFF循环，同一帧数据此字节一致(分包时同一组数据一致) |
| 包序号 | 1 byte | 当前数据包序号，从0x01开始递增(分包时，每个包序号不一样) |
| 数据包 | n byte | 根据具体要发送的数据点数量来组包 |